# 应用基本配置
spring.application.name=mentara-server
server.port=8080
server.address=0.0.0.0
server.servlet.context-path=/api

# MySQL
spring.datasource.url=jdbc:mysql://localhost:3306/mentara?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=admin20
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 时间格式配置
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone=GMT+8
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.deserialization.fail-on-unknown-properties=false


# MongoDB配置
spring.data.mongodb.uri=mongodb://root:admin20@localhost:27017/mentara?authSource=admin
spring.data.mongodb.username=root
spring.data.mongodb.password=admin20
spring.data.mongodb.authentication-database=admin

# JPA/Hibernate 配置
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# JWT 配置 - 使用256位（32字节）安全密钥
mentara.app.jwtSecret=mentaraSecretKeyForJWTAuthenticationAndAuthorizationSystem2024
mentara.app.jwtExpirationMs=86400000
mentara.app.jwtRefreshExpirationMs=604800000

# 日志配置
logging.level.com.mentara=WARN
logging.level.org.springframework.security=WARN

# 跨域配置
cors.allowed-origins=http://localhost:3000,http://localhost:3001

# Qdrant Vector Database 配置
qdrant.host=localhost
qdrant.port=6334
qdrant.timeout=30
qdrant.collection.name=post_vector

# Embedding Service配置
embedding.host=127.0.0.1
embedding.port=8081
embedding.timeout=30000

# DeepSeek API配置
deepseek.api-key=sk-c42c8bde43e247379a765f0460206db8
deepseek.base-url=https://api.deepseek.com/v1
deepseek.default-model=deepseek-chat
deepseek.timeout=30000
deepseek.max-retries=3

# Python微服务配置
python.microservice.url=http://localhost:8082
python.microservice.endpoint=/mood_score
python.microservice.depress.endpoint=/depress_check
python.microservice.timeout=10000

# 阿里云OSS配置（请替换为您的实际配置）
aliyun.oss.endpoint=oss-cn-shanghai.aliyuncs.com
aliyun.oss.access-key-id=LTAI5t6qBfKYhUozAPSFY94x
aliyun.oss.access-key-secret=28uyg6u9vSSHXWQIxXUwVVloo6TJHu
aliyun.oss.bucket-name=mentara-dev-images
aliyun.oss.base-url=https://mentara-dev-images.oss-cn-shanghai.aliyuncs.com

# 禁用数据初始化
app.data.init.enabled=false

# 文件上传配置
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.enabled=true
spring.servlet.multipart.file-size-threshold=2KB

# === 高并发优化配置 ===

# 数据库连接池配置 (HikariCP)
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.maximum-pool-size=50
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.pool-name=HikariPool
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.leak-detection-threshold=60000

# MongoDB连接池配置
spring.data.mongodb.options.max-connection-pool-size=50
spring.data.mongodb.options.min-connection-pool-size=10
spring.data.mongodb.options.max-connection-idle-time=300000
spring.data.mongodb.options.max-connection-life-time=1200000

# Tomcat服务器配置
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.max-connections=8192
server.tomcat.accept-count=100
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=20000
server.tomcat.max-keep-alive-requests=100

# JPA批处理优化
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# 异步任务配置
spring.task.execution.pool.core-size=8
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.pool.keep-alive=60s

# === 缓存配置 ===
# 启用缓存
spring.cache.type=simple
# 缓存过期时间（毫秒）
spring.cache.cache-names=users,posts,comments,notifications,userBlocks,userFollows,tags,experts,appointments,chatRooms,moodScores,statistics
# 缓存统计信息
management.endpoints.web.exposure.include=caches,health,info